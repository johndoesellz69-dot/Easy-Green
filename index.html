<!DOCTYPE html>
<html>
<head>
  <title>Easy Green Website</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
</head>
<body>
  <h1>Easy Green Website</h1>

  <div id="loginScreen">
    <input id="loginCode" placeholder="Enter your code">
    <button onclick="login()">Login</button>
  </div>

  <div id="userScreen" style="display:none;">
    <h2>User Chat</h2>
    <div id="chat"></div>
    <input id="msg" placeholder="Type message">
    <button onclick="sendMessage()">Send</button>
  </div>

  <div id="adminScreen" style="display:none;">
    <h2>Admin Dashboard</h2>
    <div id="adminChats"></div>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyA1JdHEgkIQKzX_FKZKNgLW6YEqAqMiRDo",
      authDomain: "easy-green-website.firebaseapp.com",
      databaseURL: "https://easy-green-website-default-rtdb.firebaseio.com",
      projectId: "easy-green-website",
      storageBucket: "easy-green-website.firebasestorage.app",
      messagingSenderId: "988776675269",
      appId: "1:988776675269:web:f2245f84a726d01f3e3dac",
      measurementId: "G-PR35QWS2T6"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentUser = null;
    let isAdmin = false;
    let users = {};

    // Login
    function login() {
      const code = document.getElementById('loginCode').value.trim();
      db.ref('users/' + code).once('value', snap => {
        const user = snap.val();
        if (!user) return alert('Invalid code');
        currentUser = code;
        isAdmin = !!user.isAdmin;
        document.getElementById('loginScreen').style.display = 'none';
        if (isAdmin) {
          document.getElementById('adminScreen').style.display = 'block';
          loadAdmin();
        } else {
          document.getElementById('userScreen').style.display = 'block';
          loadChat();
        }
      });
    }

    // Load chat for normal user
    function loadChat() {
      db.ref('messages/' + currentUser).on('value', snap => {
        const messages = snap.val() || [];
        let chatHtml = '';
        messages.forEach(m => {
          const fromAdmin = (m.from === 'Admin' || users[m.from]?.isAdmin);
          const label = fromAdmin ? 'Admin' : m.from;
          chatHtml += `<div><strong>${label}:</strong> ${m.text||''} ${m.img?'<br><img src="'+m.img+'" width=80>':''}</div>`;
        });
        document.getElementById('chat').innerHTML = chatHtml;
      });
    }

    // Load chats for admin
    function loadAdmin() {
      db.ref('users').on('value', snap => {
        users = snap.val() || {};
        db.ref('messages').on('value', snap => {
          const allMsgs = snap.val() || {};
          let html = '';
          Object.keys(allMsgs).forEach(userId => {
            html += `<h3>Chat with ${userId}</h3>`;
            allMsgs[userId].forEach(m => {
              const fromAdmin = (m.from === 'Admin' || users[m.from]?.isAdmin);
              const label = fromAdmin ? 'Admin' : m.from;
              html += `<div><strong>${label}:</strong> ${m.text||''} ${m.img?'<br><img src="'+m.img+'" width=80>':''}</div>`;
            });
          });
          document.getElementById('adminChats').innerHTML = html;
        });
      });
    }

    // Send message
    function sendMessage() {
      const text = document.getElementById('msg').value;
      if (!text) return;
      const msg = { from: currentUser, text };
      db.ref('messages/' + currentUser).push(msg);
      document.getElementById('msg').value = '';
    }
  </script>
</body>
</html>

