<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Easy Green</title>
<style>
:root{--accent:#2f9c4a;--muted:#6b7280;--card:#fff;--bg:#f6fff6;--maxw:980px}
*{box-sizing:border-box}
body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:linear-gradient(#f6fff6,#eefef0);color:#111}
/* ... (all your existing CSS unchanged) ... */
</style>
</head>
<body>
<!-- ... (all your modals and mainWrap HTML unchanged) ... -->

<!-- Admin Screen -->
<div id="adminScreen">
    <h2>Admin Console</h2>
    <div style="margin-bottom:12px;display:flex;gap:8px;align-items:center">
        <button class="btn" id="refreshTickets">Refresh Tickets</button>
        <button class="btn ghost" id="closeAdmin">Close Admin</button>
        <button class="btn ghost" id="toggleShutdownBtn">Toggle Shutdown</button>
        <span class="small" id="shutdownStatus" style="margin-left:8px"></span>
    </div>
    <h3>Stock Control</h3>
    <div id="adminStockArea"></div>
    <h3>All Tickets</h3>
    <div id="allTicketsArea"></div>
</div>

<!-- Firebase SDK (compat for simpler transition) -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script>
/* ---------- Firebase init ---------- */
const firebaseConfig = {
    apiKey: "AIzaSyA1JdHEgkIQKzX_FKZKNgLW6YEqAqMiRDo",
    authDomain: "easy-green-website.firebaseapp.com",
    databaseURL: "https://easy-green-website-default-rtdb.firebaseio.com",
    projectId: "easy-green-website",
    storageBucket: "easy-green-website.appspot.com",
    messagingSenderId: "988776675269",
    appId: "1:988776675269:web:f2245f84a726d01f3e3dac",
    measurementId: "G-PR35QWS2T6"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
/* ---------- end firebase ---------- */
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
const PRODUCTS=[
    {id:'c1',name:'Edibles',price:20,flavors:['Sour Patch','Skittlez','Swedish Fish','Watermelon','Starburst','Trolli','Peach Rings']},
    {id:'c2',name:'2G Ghost Disposable Carts',price:40,flavors:['Alien Burger','Durban Gushers','Papaya','Ghost Train Haze','Purple Ice cream Cake','Black Mamba']},
];

function uid6(){return Math.random().toString(36).slice(2,8).toUpperCase();}
function money(n){return '$'+n.toFixed(2);}

/* ---- Account & Login ---- */
let account = localStorage.getItem('eg_account') || '';
const acctEl = document.getElementById('acctCode');

function getAllCodes(){ return JSON.parse(localStorage.getItem('eg_codes')||'[]'); }
function addCode(c){ let arr=getAllCodes(); if(!arr.includes(c)){ arr.push(c); localStorage.setItem('eg_codes',JSON.stringify(arr)); } }
function cartKey(acc){ return 'eg_cart_'+acc; }
function ticketKey(acc){ return 'eg_tickets_'+acc; }

/* ---- show admin screen ---- */
function showAdmin(){
    document.getElementById('loginModal').classList.add('hidden');
    document.getElementById('mainWrap').classList.add('hidden'); // hide user view
    document.getElementById('adminScreen').style.display='block';

    // Render stock with correct checkbox states
    const stockArea = document.getElementById('adminStockArea');
    stockArea.innerHTML = '';
    PRODUCTS.forEach(p=>{
        const card = document.createElement('div');
        card.className='card';
        card.style.marginBottom='8px';
        const container = document.createElement('div');
        container.innerHTML = `<strong>${p.name}</strong>`;
        card.appendChild(container);

        db.ref('stock/'+p.id).once('value').then(snap=>{
            const stock = snap.val() || {};
            p.flavors.forEach(f=>{
                const row = document.createElement('div');
                row.className='flavor-stock';
                const label = document.createElement('label');
                label.style.display='flex';
                label.style.alignItems='center';
                label.style.gap='8px';
                const chk = document.createElement('input');
                chk.type='checkbox';
                chk.checked = stock[f] !== false;
                chk.dataset.prod = p.id;
                chk.dataset.flavor = f;
                chk.addEventListener('change', (e)=>{
                    const prod = e.target.dataset.prod;
                    const flav = e.target.dataset.flavor;
                    db.ref('stock/'+prod+'/'+flav).set(e.target.checked).then(()=>{
                        // realtime listener refreshes UIs automatically
                    });
                });
                const span = document.createElement('span');
                span.textContent = ' ' + f;
                label.appendChild(chk);
                label.appendChild(span);
                row.appendChild(label);
                card.appendChild(row);
            });
            stockArea.appendChild(card);
        });
    });

    renderAdminTickets();
}

/* ---- Login / Create ---- */
document.getElementById('loginBtn').onclick = () => {
    const code = document.getElementById('loginCode').value.trim();
    if(!code){ alert('Enter code'); return; }
    if(code === 'joeygold54'){ showAdmin(); return; }
    const upper = code.toUpperCase();
    if(!getAllCodes().includes(upper)){ alert('Invalid code'); return; }
    account = upper; localStorage.setItem('eg_account', account); showMainSite();
};
document.getElementById('createCodeBtn').onclick = () => {
    account = uid6(); addCode(account); localStorage.setItem('eg_account',account);
    alert('New code: '+account); showMainSite();
};

/* ---- ... rest of your JS unchanged (cart, tickets, messaging, admin send/delete, etc.) ... */

/* If not logged in at load, show login, otherwise show main site */
if(!account){ document.getElementById('loginModal').classList.remove('hidden'); } else { showMainSite(); }

}); // DOMContentLoaded
</script>
</body>
</html>


