<!doctype html>  
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Easy Green</title>
<style>
:root{--accent:#2f9c4a;--muted:#6b7280;--card:#fff;--bg:#f6fff6;--maxw:980px}
*{box-sizing:border-box}
body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:linear-gradient(#f6fff6,#eefef0);color:#111}
.wrap{max-width:var(--maxw);margin:18px auto;padding:16px}
header{display:flex;gap:12px;align-items:center}
header h1{margin:0;color:var(--accent);font-size:1.3rem}
.grid{display:grid;grid-template-columns:1fr 320px;gap:14px;margin-top:12px}
@media (max-width:900px){.grid{grid-template-columns:1fr}}
.card{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 8px 20px rgba(20,60,20,.06)}
.products{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px}
.product{border:1px solid #eee;padding:10px;border-radius:10px}
.product h3{margin:6px 0 4px}
.row{display:flex;gap:8px;align-items:center}
label{font-size:.92rem}
select,input[type="number"],input[type="file"]{padding:6px;border-radius:8px;border:1px solid #ddd}
.btn{background:var(--accent);color:white;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
.btn.ghost{background:#f3f3f3;color:#111}
.small{font-size:.88rem;color:var(--muted)}
.cart-item{display:flex;justify-content:space-between;gap:8px;padding:6px 0;border-bottom:1px dashed #eee}
.modal-back{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;padding:16px;z-index:1000}
.modal{width:100%;max-width:760px;background:white;padding:16px;border-radius:12px}
.ticket{background:#fbfff9;border:1px dashed #e6f4ea;padding:10px;border-radius:8px;height:260px;overflow:auto}
.ticket-entry{margin-bottom:8px}
footer{margin-top:12px;color:var(--muted);font-size:.82rem}
.hidden{display:none !important;}
#adminScreen{position:fixed;inset:0;background:rgba(0,0,0,.95);color:#111;padding:16px;overflow:auto;display:none;z-index:3000}
#adminScreen h2{margin-top:0;color:var(--accent)}
.flavor-stock{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}
.flavor-stock span{font-size:.88rem}
.option-disabled{color:#aaa !important}
</style>
</head>
<body>

<!-- Login / Create Code Modal -->
<div id="loginModal" class="modal-back">
  <div class="modal">
    <h3>Login</h3>
    <div style="margin-bottom:12px">
      <label>Enter your login code or Create Account if new:
        <input type="text" id="loginCode">
      </label>
    </div>
    <div style="margin-bottom:12px">or <button class="btn" id="createCodeBtn">Create new code</button></div>
    <div style="display:flex;justify-content:flex-end;gap:8px">
      <button class="btn" id="loginBtn">Login</button>
    </div>
  </div>
</div>

<!-- Warning modal -->
<div id="warningModal" class="modal-back hidden">
  <div class="modal">
    <h3>Warnings & Rules</h3>
    <ul>
      <li>Easy Green is not liable for any stolen Product/Payments.</li>
      <li>Use products safely.</li>
      <li>Respect site anonymity.</li>
    </ul>
    <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
      <label style="display:flex;align-items:center;gap:8px">
        <input type="checkbox" id="ackCheck"> I agree
      </label>
      <button class="btn" id="ackBtn">Confirm</button>
    </div>
  </div>
</div>

<!-- First Time Help Modal -->
<div id="helpModal" class="modal-back hidden">
  <div class="modal">
    <h3>First Time Help</h3>
    <p>Welcome to Easy Green! Here's how it works:</p>
    <ol>
      <li>Select products and flavors you want.</li>
      <li>Add items to your cart and choose pickup location.</li>
      <li>Click Purchase to generate a ticket for your order.</li>
      <li>Use the chat under your ticket to send messages or images to admin.</li>
      <li>Admin can respond and send images back. Keep communications secure and anonymous.</li>
      <li>Place the specified cash amount in an Envelope, and write a 4 digit code of your choosing on the Envelope</li>
      <li>Hide Envelope at your selected location in a very discreet and out of sight spot (Easy Green is not liable for stolen payments)</li>
      <li>Select the "Mark as paid" button, and send a photo of your envelope and where you hid it. (Make sure to not send a picture that shows your 4 digit code)</li>
      <li>Head home and wait for the deliverant to pick up your payment and hide your item. Once finished, the admin will message you your 4 digit code, an image of the product hidden, and any further information.</li>
      <li>Go pickup your product and have fun!</li>
    </ol>
    <button class="btn" id="closeHelp">Got it!</button>
  </div>
</div>

<!-- Main site -->
<div class="wrap hidden" id="mainWrap">
  <header>
    <svg width="44" height="44" viewBox="0 0 24 24" aria-hidden>
      <rect rx="6" width="24" height="24" fill="#2f9c4a"/>
      <text x="50%" y="60%" font-size="10" text-anchor="middle" fill="white" font-family="sans-serif">EG</text>
    </svg>
    <div><h1>Easy Green â€” Anonymous Cannabis </h1></div>
    <button class="btn ghost" id="logoutBtn" style="margin-left:auto">Log Out</button>
  </header>
  <div style="display:flex;gap:8px;align-items:center;margin-top:12px">
    <div class="small">(Write this down) Your account code: <span id="acctCode"></span></div>
    <button class="btn" id="helpBtn" style="margin-left:auto">First time help</button>
  </div>
  <div class="grid" role="main">
    <section class="card" aria-labelledby="productsLabel">
      <h2 id="productsLabel">Products</h2>
      <div class="small" style="margin-bottom:8px">Select flavors and add to cart.</div>
      <div class="products" id="productsGrid"></div>
    </section>
    <aside class="card" aria-labelledby="cartLabel">
      <h2 id="cartLabel">Cart & Pickup</h2>
      <div>
        <label class="small">Pickup Location</label>
        <select id="locationSelect" aria-label="Pickup location">
          <option value="Hasbrook Park">Hasbrook Park</option>
          <option value="Virginia Terrace Park">Virginia Terrace Park</option>
          <option value="Frontier Park">Frontier Park</option>
          <option value="Pioneer Park">Pioneer Park</option>
          <option value="Grealish Park">Grealish Park</option>
          <option value="Happiness Park">Happiness Park</option>
          <option value="Greenbrier Park">Greenbrier Park</option>
          <option value="Kimball Hill Park">Kimball Hill Park</option>
          <option value="Centennial Park">Centennial Park</option>
        </select>
      </div>
      <div style="margin-top:12px">
        <div id="cartList" aria-live="polite"></div>
        <div class="cart-total small" id="cartTotal"></div>
      </div>
      <div style="margin-top:12px;display:flex;gap:8px">
        <button class="btn" id="purchaseBtn">Purchase</button>
        <button class="btn ghost" id="clearBtn">Clear</button>
      </div>
      <div style="margin-top:12px">
        <div class="small">Tickets </div>
        <div id="ticketsArea" style="margin-top:8px"></div>
      </div>
    </aside>
  </div>
  <footer> Easy Green only accepts cash payments. Fake cash will result in a ban. </footer>
</div>

<!-- Admin Screen -->
<div id="adminScreen">
  <h2>Admin Console</h2>
  <div style="margin-bottom:12px">
    <button class="btn" id="refreshTickets">Refresh Tickets</button>
    <button class="btn ghost" id="closeAdmin">Close Admin</button>
  </div>
  <h3>Stock Control</h3>
  <div id="adminStockArea"></div>
  <h3>All Tickets</h3>
  <div id="allTicketsArea"></div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script>
// Firebase setup
const firebaseConfig = {
  apiKey: "<YOUR_API_KEY>",
  authDomain: "<YOUR_PROJECT_ID>.firebaseapp.com",
  databaseURL: "https://easy-green-website-default-rtdb.firebaseio.com/",
  projectId: "<YOUR_PROJECT_ID>",
  storageBucket: "<YOUR_PROJECT_ID>.appspot.com",
  messagingSenderId: "<YOUR_SENDER_ID>",
  appId: "<YOUR_APP_ID>"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>

<!-- App Script -->
<script>
let currentUser = null;
let cart = [];

const products = [
  { id:'flower', name:'Flower', flavors:['OG Kush','Blue Dream','Sour Diesel'], price:25 },
  { id:'edibles', name:'Edibles', flavors:['Gummy Bears','Chocolate Bar'], price:15 },
  { id:'carts', name:'Carts', flavors:['Mint','Strawberry'], price:40 }
];

function renderProducts(){
  const grid=document.getElementById('productsGrid');
  grid.innerHTML='';
  products.forEach(p=>{
    const div=document.createElement('div'); div.className='product';
    div.innerHTML=`<h3>${p.name} - $${p.price}</h3>`;
    p.flavors.forEach(f=>{
      const row=document.createElement('div'); row.className='row';
      row.innerHTML=`<span>${f}</span><input type="number" min="0" value="0" style="width:50px">`;
      div.appendChild(row);
    });
    grid.appendChild(div);
  });
}

// Cart rendering and update
function renderCart(){
  const list=document.getElementById('cartList');
  list.innerHTML='';
  let total=0;
  const grid=document.getElementById('productsGrid');
  products.forEach((p,pi)=>{
    p.flavors.forEach((f,fi)=>{
      const qty=parseInt(grid.children[pi].children[fi+1].querySelector('input').value);
      if(qty>0){
        const div=document.createElement('div'); div.className='cart-item';
        div.textContent=`${p.name} - ${f} x${qty} = $${(qty*p.price).toFixed(2)}`;
        list.appendChild(div);
        total+=qty*p.price;
      }
    });
  });
  document.getElementById('cartTotal').textContent=`Total: $${total.toFixed(2)}`;
}

// Tickets & chat rendering
function renderTickets(){
  const area=document.getElementById('ticketsArea');
  area.innerHTML='';
  db.ref('tickets').once('value',snap=>{
    const tickets=snap.val()||{};
    Object.values(tickets).forEach(t=>{
      if(t.user===currentUser){
        const div=document.createElement('div'); div.className='ticket';
        div.innerHTML=`<div class="ticket-entry"><strong>${t.id}</strong> | $${t.total.toFixed(2)} | ${t.status}</div>
          <div id="chat-${t.id}" style="height:120px;overflow:auto;border-top:1px dashed #ddd;margin-top:4px;padding-top:4px"></div>
          <div style="display:flex;gap:4px;margin-top:4px">
            <input type="text" placeholder="Message" class="msgInput" style="flex:1">
            <input type="file" class="imgInput" style="flex:1">
            <button class="btn sendBtn">Send</button>
          </div>`;
        area.appendChild(div);
        const chatEl=document.getElementById('chat-'+t.id);
        db.ref('messages/'+t.id).on('value',msgSnap=>{
          const msgs=msgSnap.val()||{};
          chatEl.innerHTML=Object.values(msgs).map(m=>{
            return m.image ? `<div><strong>${m.from}:</strong><br><img src="${m.image}" style="max-width:100px;border-radius:6px"></div>` :
            `<div><strong>${m.from}:</strong> ${m.text}</div>`;
          }).join('');
          chatEl.scrollTop=chatEl.scrollHeight;
        });
        div.querySelector('.sendBtn').onclick=()=>{
          const text=div.querySelector('.msgInput').value.trim();
          const file=div.querySelector('.imgInput').files[0];
          if(!text && !file){alert('Write message or choose image');return;}
          if(file){
            const reader=new FileReader();
            reader.onload=e=>{
              db.ref('messages/'+t.id).push({from:'User', image:e.target.result});
              div.querySelector('.imgInput').value='';
            }; reader.readAsDataURL(file);
          }
          if(text){
            db.ref('messages/'+t.id).push({from:'User', text});
            div.querySelector('.msgInput').value='';
          }
        };
      }
    });
  });
}

// Admin tickets rendering
function renderAdminTickets(){
  const area=document.getElementById('allTicketsArea');
  db.ref('tickets').on('value',snap=>{
    const tickets=snap.val()||{};
    area.innerHTML='';
    Object.entries(tickets).forEach(([id,t])=>{
      const div=document.createElement('div'); div.className='ticket'; div.style.marginBottom='6px';
      div.innerHTML=`<div class="ticket-entry"><strong>${t.id}</strong> @ ${t.location} | $${t.total.toFixed(2)} | ${t.status}</div>
        <div id="admin-chat-${id}" style="height:120px;overflow:auto;border-top:1px dashed #ddd;margin-top:4px;padding-top:4px"></div>
        <div style="display:flex;gap:4px;margin-top:4px">
          <input type="text" placeholder="Message" class="msgInput" style="flex:1">
          <input type="file" class="imgInput" style="flex:1">
          <button class="btn sendBtn">Send</button>
        </div>`;
      area.appendChild(div);
      const chatEl=document.getElementById('admin-chat-'+id);
      db.ref('messages/'+id).on('value',msgSnap=>{
        const msgs=msgSnap.val()||{};
        chatEl.innerHTML=Object.values(msgs).map(m=>{
          return m.image ? `<div><strong>${m.from}:</strong><br><img src="${m.image}" style="max-width:100px;border-radius:6px"></div>` :
          `<div><strong>${m.from}:</strong> ${m.text}</div>`;
        }).join('');
        chatEl.scrollTop=chatEl.scrollHeight;
      });
      div.querySelector('.sendBtn').onclick=()=>{
        const text=div.querySelector('.msgInput').value.trim();
        const file=div.querySelector('.imgInput').files[0];
        if(!text && !file){alert('Write message or choose image');return;}
        if(file){
          const reader=new FileReader();
          reader.onload=e=>{
            db.ref('messages/'+id).push({from:'Admin', image:e.target.result});
            div.querySelector('.imgInput').value='';
          }; reader.readAsDataURL(file);
        }
        if(text){
          db.ref('messages/'+id).push({from:'Admin', text});
          div.querySelector('.msgInput').value='';
        }
      };
    });
  });
}

// Buttons
document.getElementById('helpBtn').onclick=()=>document.getElementById('helpModal').classList.remove('hidden');
document.getElementById('closeHelp').onclick=()=>document.getElementById('helpModal').classList.add('hidden');
document.getElementById('logoutBtn').onclick=()=>{
  currentUser=null;
  document.getElementById('mainWrap').classList.add('hidden');
  document.getElementById('loginModal').classList.remove('hidden');
};

document.getElementById('createCodeBtn').onclick=()=>{
  const code=Math.random().toString(36).slice(2,8);
  db.ref('users/'+code).set({created:Date.now()});
  alert('Your new code: '+code);
};

document.getElementById('loginBtn').onclick=()=>{
  const code=document.getElementById('loginCode').value.trim();
  if(!code){alert('Enter code'); return;}
  if(code==='joeygold54'){
    document.getElementById('loginModal').classList.add('hidden');
    document.getElementById('adminScreen').style.display='block';
    renderAdminTickets(); return;
  }
  db.ref('users/'+code).get().then(snap=>{
    if(!snap.exists()){alert('Code not found'); return;}
    currentUser=code;
    document.getElementById('acctCode').textContent=currentUser;
    document.getElementById('loginModal').classList.add('hidden');
    document.getElementById('mainWrap').classList.remove('hidden');
    renderProducts();
  });
};

// Cart buttons
document.getElementById('purchaseBtn').onclick=()=>{
  const location=document.getElementById('locationSelect').value;
  let total=0; const items=[];
  const grid=document.getElementById('productsGrid');
  products.forEach((p,pi)=>{
    p.flavors.forEach((f,fi)=>{
      const qty=parseInt(grid.children[pi].children[fi+1].querySelector('input').value);
      if(qty>0){items.push({product:p.name,flavor:f,qty,price:p.price}); total+=qty*p.price;}
    });
  });
  if(items.length===0){alert('Add items'); return;}
  const ticketId='T'+Date.now();
  db.ref('tickets/'+ticketId).set({id:ticketId,user:currentUser,items,location,total,status:'Pending'});
  alert('Ticket created: '+ticketId);
  renderTickets();
};

document.getElementById('clearBtn').onclick=()=>{
  const grid=document.getElementById('productsGrid');
  products.forEach((p,pi)=>p.flavors.forEach((f,fi)=>grid.children[pi].children[fi+1].querySelector('input').value=0));
  renderCart();
};
document.getElementById('productsGrid').addEventListener('input',renderCart);

// Admin buttons
document.getElementById('refreshTickets').onclick=renderAdminTickets;
document.getElementById('closeAdmin').onclick=()=>document.getElementById('adminScreen').style.display='none';
</script>
</body>
</html>

