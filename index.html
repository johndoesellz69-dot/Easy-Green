<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Easy Green Admin</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<style>
body { background:#111; color:#eee; font-family: Arial, sans-serif; }
.admin-container { padding:20px; }
h2 { margin-top:20px; color:#90ee90; }
.stock-item { display:flex; align-items:center; margin:4px 0; }
label { margin-left:6px; }
.tickets { margin-top:20px; padding:10px; background:#222; border-radius:8px; }
.ticket { padding:6px; border-bottom:1px solid #444; }
button { margin:5px; padding:6px 10px; border:none; border-radius:6px; background:#228b22; color:#fff; cursor:pointer; }
button:hover { background:#2ecc71; }
</style>
</head>
<body>

<div id="loginPanel">
  <div style="padding:20px;background:#222;border-radius:10px;width:300px;margin:auto;margin-top:100px;">
    <h2>Login</h2>
    <input type="text" id="loginCode" placeholder="Enter your code or admin" />
    <button onclick="login()">Login</button>
  </div>
</div>

<div class="admin-container" id="adminPanel" style="display:none;">
  <h1>Admin Console</h1>
  <button onclick="refreshTickets()">Refresh Tickets</button>
  <button onclick="closeAdmin()">Close Admin</button>
  <h2>Stock Control</h2>
  <div id="stockControl"></div>
  <h2>All Tickets</h2>
  <div id="tickets" class="tickets"></div>
</div>

<script>
// Firebase config (replace with your project values)
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Login function
function login() {
  const code = document.getElementById("loginCode").value.trim().toLowerCase();
  if (code === "joeygold54") { // Admin login
    document.getElementById("loginPanel").style.display = "none";
    document.getElementById("adminPanel").style.display = "block";
    loadStock();
    listenForTickets();
    return;
  }

  // User login
  const codes = JSON.parse(localStorage.getItem('eg_codes')||'[]');
  if (!codes.includes(code)) {
    alert("Invalid code");
    return;
  }
  alert("User logged in: "+code);
  // Here you would redirect/show main user site
}

// Close admin
function closeAdmin() {
  document.getElementById("adminPanel").style.display = "none";
  document.getElementById("loginPanel").style.display = "block";
}

// Load stock checkboxes
function loadStock() {
  const stockDiv = document.getElementById("stockControl");
  stockDiv.innerHTML = "";
  db.ref("stock").once("value", snapshot => {
    snapshot.forEach(catSnap => {
      const catTitle = document.createElement("h3");
      catTitle.textContent = catSnap.key;
      stockDiv.appendChild(catTitle);
      catSnap.forEach(itemSnap => {
        const div = document.createElement("div");
        div.className = "stock-item";
        const chk = document.createElement("input");
        chk.type = "checkbox";
        chk.checked = itemSnap.val();
        chk.onchange = () => {
          db.ref("stock/"+catSnap.key+"/"+itemSnap.key).set(chk.checked);
        };
        const label = document.createElement("label");
        label.textContent = itemSnap.key;
        div.appendChild(chk);
        div.appendChild(label);
        stockDiv.appendChild(div);
      });
    });
  });
}

// Tickets real-time listener
function listenForTickets() {
  const ticketsDiv = document.getElementById("tickets");
  db.ref("tickets").on("value", snapshot => {
    ticketsDiv.innerHTML = "";
    if (!snapshot.exists()) {
      ticketsDiv.innerHTML = "<i>No tickets yet</i>";
      return;
    }
    snapshot.forEach(ticketSnap => {
      const div = document.createElement("div");
      div.className = "ticket";
      div.textContent = JSON.stringify(ticketSnap.val(), null, 2);
      ticketsDiv.appendChild(div);
    });
  });
}

// Refresh tickets manually
function refreshTickets() {
  listenForTickets();
}
</script>

</body>
</html>
