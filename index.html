<!doctype html>  
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Easy Green</title>
<style>
:root{--accent:#2f9c4a;--muted:#6b7280;--card:#fff;--bg:#f6fff6;--maxw:980px}
*{box-sizing:border-box}
body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:linear-gradient(#f6fff6,#eefef0);color:#111}
.wrap{max-width:var(--maxw);margin:18px auto;padding:16px}
header{display:flex;gap:12px;align-items:center}
header h1{margin:0;color:var(--accent);font-size:1.3rem}
.grid{display:grid;grid-template-columns:1fr 320px;gap:14px;margin-top:12px}
@media (max-width:900px){.grid{grid-template-columns:1fr}}
.card{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 8px 20px rgba(20,60,20,.06)}
.products{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px}
.product{border:1px solid #eee;padding:10px;border-radius:10px}
.product h3{margin:6px 0 4px}
.row{display:flex;gap:8px;align-items:center}
label{font-size:.92rem}
select,input[type="number"],input[type="file"]{padding:6px;border-radius:8px;border:1px solid #ddd}
.btn{background:var(--accent);color:white;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
.btn.ghost{background:#f3f3f3;color:#111}
.small{font-size:.88rem;color:var(--muted)}
.cart-item{display:flex;justify-content:space-between;gap:8px;padding:6px 0;border-bottom:1px dashed #eee}
.modal-back{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;padding:16px;z-index:1000}
.modal{width:100%;max-width:760px;background:white;padding:16px;border-radius:12px}
.ticket{background:#fbfff9;border:1px dashed #e6f4ea;padding:10px;border-radius:8px;height:260px;overflow:auto}
.ticket-entry{margin-bottom:8px}
footer{margin-top:12px;color:var(--muted);font-size:.82rem}
.hidden{display:none !important;}
#adminScreen{position:fixed;inset:0;background:rgba(0,0,0,.95);color:#111;padding:16px;overflow:auto;display:none;z-index:3000}
#adminScreen h2{margin-top:0;color:var(--accent)}
.flavor-stock{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}
.flavor-stock span{font-size:.88rem}
.option-disabled{color:#aaa !important}
</style>
</head>
<body>

<!-- Login / Create Code Modal -->
<div id="loginModal" class="modal-back">
  <div class="modal">
    <h3>Login</h3>
    <div style="margin-bottom:12px">
      <label>Enter your login code or Create Account if new: <input type="text" id="loginCode"></label>
    </div>
    <div style="margin-bottom:12px">or <button class="btn" id="createCodeBtn">Create new code</button></div>
    <div style="display:flex;justify-content:flex-end;gap:8px">
      <button class="btn" id="loginBtn">Login</button>
    </div>
  </div>
</div>

<!-- Warning modal -->
<div id="warningModal" class="modal-back hidden">
  <div class="modal">
    <h3>Warnings & Rules</h3>
    <ul>
      <li>Easy Green is not liable for any stolen Product/Payments.</li>
      <li>Use products safely.</li>
      <li>Respect site anonymity.</li>
    </ul>
    <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
      <label style="display:flex;align-items:center;gap:8px">
        <input type="checkbox" id="ackCheck"> I agree
      </label>
      <button class="btn" id="ackBtn">Confirm</button>
    </div>
  </div>
</div>

<!-- First Time Help Modal -->
<div id="helpModal" class="modal-back hidden">
  <div class="modal">
    <h3>First Time Help</h3>
    <p>Welcome to Easy Green! Here's how it works:</p>
    <ol>
      <li>Select products and flavors you want.</li>
      <li>Add items to your cart and choose pickup location.</li>
      <li>Click Purchase to generate a ticket for your order.</li>
      <li>Use the chat under your ticket to send messages or images to admin.</li>
      <li>Admin can respond and send images back. Keep communications secure and anonymous.</li>
      <li>Place the specified cash amount in an Envelope, and write a 4 digit code of your choosing on the Envelope</li>
      <li>Hide Envelope at your selected location in a very discreet and out of sight spot (Easy Green is not liable for stolen payments)</li>
      <li>Select the "Mark as paid" button, and send a photo of your envelope and where you hid it. (Make sure to not send a picture that shows your 4 digit code)</li>
      <li>Head home and wait for the deliverant to pick up your payment and hide your item. Once finished, the admin will message you your 4 digit code, an image of the product hidden, and any further information.</li>
      <li>Go pickup your product and have fun!</li>

    </ol>
    <button class="btn" id="closeHelp">Got it!</button>
  </div>
</div>

<!-- Main site -->
<div class="wrap hidden" id="mainWrap">
  <header>
    <svg width="44" height="44" viewBox="0 0 24 24" aria-hidden>
      <rect rx="6" width="24" height="24" fill="#2f9c4a"/>
      <text x="50%" y="60%" font-size="10" text-anchor="middle" fill="white" font-family="sans-serif">EG</text>
    </svg>
    <div>
      <h1>Easy Green â€” Anonymous Cannabis </h1>
    </div>
  </header>

  <div style="display:flex;gap:8px;align-items:center;margin-top:12px">
    <div class="small">(Write this down) Your account code: <span id="acctCode"></span></div>
    <button class="btn" id="helpBtn" style="margin-left:auto">First time help</button>
  </div>

  <div class="grid" role="main">
    <section class="card" aria-labelledby="productsLabel">
      <h2 id="productsLabel">Products</h2>
      <div class="small" style="margin-bottom:8px">Select flavors and add to cart.</div>
      <div class="products" id="productsGrid"></div>
    </section>

    <aside class="card" aria-labelledby="cartLabel">
      <h2 id="cartLabel">Cart & Pickup</h2>
      <div>
        <label class="small">Pickup Location</label>
        <select id="locationSelect" aria-label="Pickup location">
          <option value="Hasbrook Park">Hasbrook Park</option>
          <option value="Virginia Terrace Park">Virginia Terrace Park</option>
          <option value="Frontier Park">Frontier Park</option>
          <option value="Pioneer Park">Pioneer Park</option>
          <option value="Grealish Park">Grealish Park</option>
          <option value="Happiness Park">Happiness Park</option>
          <option value="Greenbrier Park">Greenbrier Park</option>
          <option value="Kimball Hill Park">Kimball Hill Park</option>
          <option value="Centennial Park">Centennial Park</option>
        </select>
      </div>

      <div style="margin-top:12px">
        <div id="cartList" aria-live="polite"></div>
        <div class="cart-total small" id="cartTotal"></div>
      </div>

      <div style="margin-top:12px;display:flex;gap:8px">
        <button class="btn" id="purchaseBtn">Purchase</button>
        <button class="btn ghost" id="clearBtn">Clear</button>
      </div>

      <div style="margin-top:12px">
        <div class="small">Tickets </div>
        <div id="ticketsArea" style="margin-top:8px"></div>
      </div>
    </aside>
  </div>

  <footer>
    Easy Green only accepts cash payments. Fake cash will result in a ban.
  </footer>
</div>

<!-- Admin Screen -->
<div id="adminScreen">
  <h2>Admin Console</h2>
  <div style="margin-bottom:12px">
    <button class="btn" id="refreshTickets">Refresh Tickets</button>
    <button class="btn ghost" id="closeAdmin">Close Admin</button>
  </div>
  <h3>Stock Control</h3>
  <div id="adminStockArea"></div>
  <h3>All Tickets</h3>
  <div id="allTicketsArea"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
const PRODUCTS=[
  {id:'c1',name:'Edibles',price:20,flavors:['Sour Patch','Skittlez','Swedish Fish','Watermelon','Starburst','Trolli','Peach Rings']},
  {id:'c2',name:'2G Ghost Disposable Carts',price:40,flavors:['Alien Burger','Durban Gushers','Papaya','Ghost Train Haze','Purple Ice cream Cake','Black Mamba']},
];
function uid6(){return Math.random().toString(36).slice(2,8).toUpperCase();}
function money(n){return '$'+n.toFixed(2);}

/* ---- Account & Login ---- */
let account=localStorage.getItem('eg_account')||'';
const acctEl=document.getElementById('acctCode');
function getAllCodes(){return JSON.parse(localStorage.getItem('eg_codes')||'[]');}
function addCode(c){let arr=getAllCodes();if(!arr.includes(c)){arr.push(c);localStorage.setItem('eg_codes',JSON.stringify(arr));}}
function cartKey(acc){return 'eg_cart_'+acc;}
function ticketKey(acc){return 'eg_tickets_'+acc;}
function showMainSite(){document.getElementById('loginModal').classList.add('hidden');document.getElementById('mainWrap').classList.remove('hidden');document.getElementById('warningModal').classList.remove('hidden');acctEl.textContent=account;initSiteScripts();}

/* ---- Login / Create ---- */
document.getElementById('loginBtn').onclick=()=>{
  const code=document.getElementById('loginCode').value.trim();
  if(!code){alert('Enter code');return;}
  if(code==='joeygold54'){showAdmin();return;}
  const upper=code.toUpperCase();
  if(!getAllCodes().includes(upper)){alert('Invalid code');return;}
  account=upper;localStorage.setItem('eg_account',account);showMainSite();
};
document.getElementById('createCodeBtn').onclick=()=>{
  account=uid6();addCode(account);localStorage.setItem('eg_account',account);alert('New code: '+account);showMainSite();
};
document.getElementById('ackBtn').onclick=()=>{
  if(!document.getElementById('ackCheck').checked){alert('Confirm rules');return;}
  localStorage.setItem('eg_ack','1');document.getElementById('warningModal').classList.add('hidden');
};

/* ---- First Time Help ---- */
document.getElementById('helpBtn').onclick=()=>{document.getElementById('helpModal').classList.remove('hidden');};
document.getElementById('closeHelp').onclick=()=>{document.getElementById('helpModal').classList.add('hidden');};

/* ---- Admin Screen ---- */
document.getElementById('closeAdmin').onclick=()=>{document.getElementById('adminScreen').style.display='none';};
document.getElementById('refreshTickets').addEventListener('click',renderAdminTickets);
function showAdmin(){document.getElementById('adminScreen').style.display='block';renderAdminStock();renderAdminTickets();}

/* ---- Site scripts ---- */
function initSiteScripts(){
  const grid=document.getElementById('productsGrid');grid.innerHTML='';
  PRODUCTS.forEach(p=>{
    const stock=JSON.parse(localStorage.getItem('eg_stock_'+p.id)||'{}');
    const el=document.createElement('div');el.className='product';
    el.innerHTML=<h3>${p.name}</h3>
      <div class="small">Price: ${money(p.price)}</div>
      <label>Flavor<select aria-label="flavor-${p.id}" class="flavorSelect">${p.flavors.map(f=>{const disabled=stock[f]===false?'disabled class="option-disabled"':'';return <option ${disabled}>${f}</option>;}).join('')}</select></label>
      <label>Qty<input type="number" min="1" value="1" class="qtyInput" style="width:70px"></label>
      <div style="margin-top:8px"><button class="btn addBtn">Add</button></div>;
    grid.appendChild(el);
    el.querySelector('.addBtn').addEventListener('click',()=>{
      const flavor=el.querySelector('.flavorSelect').value;
      const qty=Number(el.querySelector('.qtyInput').value)||1;
      if(stock[flavor]===false){alert('Flavor out of stock');return;}
      addToCart({productId:p.id,name:p.name,flavor,qty,price:p.price,image:null});
    });
  });

  let cart=JSON.parse(localStorage.getItem(cartKey(account))||'[]');
  let tickets=JSON.parse(localStorage.getItem(ticketKey(account))||'[]');
  const cartList=document.getElementById('cartList');const cartTotalEl=document.getElementById('cartTotal');const ticketsArea=document.getElementById('ticketsArea');
  function saveCart(){localStorage.setItem(cartKey(account),JSON.stringify(cart));renderCart();}
  function saveTickets(){localStorage.setItem(ticketKey(account),JSON.stringify(tickets));renderTickets();}
  function addToCart(item){cart.push(item);saveCart();alert('Added to cart');}

  function renderCart(){
    cartList.innerHTML='';if(cart.length===0){cartList.innerHTML='<div class="small">Cart empty.</div>';cartTotalEl.textContent='';return;}
    cart.forEach((it,idx)=>{
      const div=document.createElement('div');div.className='cart-item';
      div.innerHTML=<div><div style="font-weight:600">${it.name} Ã—${it.qty}</div><div class="small">${it.flavor}</div>${it.image?'<img src="'+it.image+'" style="width:60px;margin-top:4px;border-radius:6px">':''}</div>
        <div style="text-align:right"><div>${money(it.price*it.qty)}</div><div style="margin-top:6px"><button class="btn ghost" data-i="${idx}">Remove</button></div></div>;
      cartList.appendChild(div);
      div.querySelector('button').addEventListener('click',(e)=>{cart.splice(Number(e.target.dataset.i),1);saveCart();});
    });
    const total=cart.reduce((s,i)=>s+i.price*i.qty,0);cartTotalEl.textContent=Total: ${money(total)};
  }

  document.getElementById('purchaseBtn').addEventListener('click',()=>{
    if(cart.length===0){alert('Cart empty');return;}
    const loc=document.getElementById('locationSelect').value;
    const tid='T-'+Math.random().toString(36).slice(2,8).toUpperCase();
    const items=JSON.parse(JSON.stringify(cart));const total=items.reduce((s,i)=>s+i.price*i.qty,0);
    const ticket={id:tid,account,location:loc,items,total,status:'open',messages:[{from:'System',text:Ticket created. Total ${money(total)}. Hide payment at ${loc}.} ]};
    tickets.push(ticket);saveTickets();cart=[];saveCart();alert('Ticket created: '+tid);
  });
  document.getElementById('clearBtn').addEventListener('click',()=>{if(confirm('Clear cart?')){cart=[];saveCart();}});

  renderCart();
  renderTickets();

  function renderTickets(){
    ticketsArea.innerHTML='';if(tickets.length===0){ticketsArea.innerHTML='<div class="small">No tickets yet.</div>';return;}
    tickets.forEach(t=>{
      const el=document.createElement('div');el.className='card';el.style.marginBottom='8px';
      el.innerHTML=<div style="display:flex;justify-content:space-between;align-items:center">
        <div><strong>Ticket ${t.id}</strong> <span class="small">(${t.status})</span></div>
        <div class="small">${t.location}</div>
      </div>
      <div class="small" style="margin-top:6px">${t.items.map(it=>${it.name} Ã—${it.qty} (${it.flavor})).join(' â€¢ ')}</div>
      <div style="margin-top:8px" id="ticket-${t.id}">
        <div class="ticket" id="chat-${t.id}">${(t.messages||[]).map(m=>{if(m.image)return <div><strong>${m.from}:</strong><br><img src="${m.image}" style="max-width:100px;border-radius:6px"></div>;return <div><strong>${m.from}:</strong> ${m.text}</div>;}).join('')}</div>
        <input type="text" placeholder="Send message" id="msg-${t.id}" style="width:50%;padding:4px">
        <input type="file" accept="image/*" id="file-${t.id}" style="margin-top:4px">
        <button class="btn" onclick="sendUserMsg('${t.id}')">Send</button>
        <button class="btn ghost" onclick="markPaid('${t.id}')">Mark Paid</button>
        <button class="btn ghost" onclick="cancelOrder('${t.id}')">Cancel</button>
      </div>; 
      ticketsArea.appendChild(el);
    });
  }

  window.sendUserMsg=function(tid){
    const msgEl=document.getElementById('msg-'+tid);
    const fileEl=document.getElementById('file-'+tid);
    if(!msgEl && !fileEl)return;
    let t=tickets.find(x=>x.id===tid);if(!t)return;
    if(fileEl.files[0]){
      const reader=new FileReader();
      reader.onload=(e)=>{t.messages.push({from:'User',image:e.target.result});saveTickets();renderTickets();};
      reader.readAsDataURL(fileEl.files[0]);
    }
    const txt=msgEl.value.trim();if(txt){t.messages.push({from:'User',text:txt});saveTickets();msgEl.value='';renderTickets();}
  };
  window.markPaid=function(tid){let t=tickets.find(x=>x.id===tid);if(!t)return;t.status='paid';saveTickets();}
  window.cancelOrder=function(tid){if(!confirm('Cancel this order?'))return;let idx=tickets.findIndex(x=>x.id===tid);if(idx>-1){tickets.splice(idx,1);saveTickets();}}
}

/* ---- Admin Functions ---- */
function renderAdminStock(){
  const area=document.getElementById('adminStockArea');area.innerHTML='';
  PRODUCTS.forEach(p=>{
    const stock=JSON.parse(localStorage.getItem('eg_stock_'+p.id)||'{}');
    const card=document.createElement('div');card.className='card';card.style.marginBottom='8px';
    card.innerHTML=<strong>${p.name}</strong>;
    p.flavors.forEach(f=>{
      const chk=document.createElement('input');chk.type='checkbox';chk.checked=stock[f]!==false;chk.dataset.prod=p.id;chk.dataset.flavor=f;
      chk.addEventListener('change',()=>{let s=JSON.parse(localStorage.getItem('eg_stock_'+p.id)||'{}');s[f]=chk.checked;localStorage.setItem('eg_stock_'+p.id,JSON.stringify(s));initSiteScripts();});
      const label=document.createElement('label');label.style.display='block';label.append(chk,document.createTextNode(' '+f));
      card.appendChild(label);
    });
    area.appendChild(card);
  });
}

function renderAdminTickets(){
  const allTicketsArea=document.getElementById('allTicketsArea');allTicketsArea.innerHTML='';
  const allCodes=getAllCodes();
  allCodes.forEach(ac=>{
    const tix=JSON.parse(localStorage.getItem(ticketKey(ac))||'[]');
    tix.forEach(t=>{
      const div=document.createElement('div');div.className='card';div.style.marginBottom='8px';
      div.innerHTML=<div style="font-weight:600">Ticket ${t.id} | Account: ${t.account} | Location: ${t.location} | Status: ${t.status}</div>
        <div class="small">${t.items.map(i=>i.name+' Ã—'+i.qty+' ('+i.flavor+')').join(' â€¢ ')}</div>
        <div id="adminChat-${t.id}" class="ticket">${(t.messages||[]).map(m=>{if(m.image)return <div><strong>${m.from}:</strong><br><img src="${m.image}" style="max-width:100px;border-radius:6px"></div>;return <div><strong>${m.from}:</strong> ${m.text}</div>;}).join('')}</div>
        <input placeholder="Admin message" id="adminMsg-${t.id}" style="flex:1;padding:4px">
        <input type="file" accept="image/*" id="adminFile-${t.id}" style="margin-top:4px">
        <button class="btn" onclick="sendAdmin('${t.account}','${t.id}')">Send</button>
        <button class="btn ghost" onclick="deleteOrder('${t.account}','${t.id}')">Delete</button>;
      allTicketsArea.appendChild(div);
    });
  });
}

window.sendAdmin=function(acc,ticketId){
  const msgEl=document.getElementById('adminMsg-'+ticketId);
  const fileEl=document.getElementById('adminFile-'+ticketId);
  let tix=JSON.parse(localStorage.getItem(ticketKey(acc))||'[]');let t=tix.find(x=>x.id===ticketId);if(!t)return;
  if(fileEl.files[0]){
    const reader=new FileReader();
    reader.onload=(e)=>{t.messages.push({from:'Admin',image:e.target.result});localStorage.setItem(ticketKey(acc),JSON.stringify(tix));renderAdminTickets();};
    reader.readAsDataURL(fileEl.files[0]);
  }
  if(msgEl.value.trim()){t.messages.push({from:'Admin',text:msgEl.value.trim()});msgEl.value='';localStorage.setItem(ticketKey(acc),JSON.stringify(tix));renderAdminTickets();}
};

window.deleteOrder=function(acc,tid){
  if(!confirm('Delete this ticket?'))return;
  let tix=JSON.parse(localStorage.getItem(ticketKey(acc))||'[]');
  const idx=tix.findIndex(x=>x.id===tid);
  if(idx>-1){tix.splice(idx,1);localStorage.setItem(ticketKey(acc),JSON.stringify(tix));renderAdminTickets();}
};
});
</script>
</body>
</html>

