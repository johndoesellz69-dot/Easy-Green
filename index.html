<!doctype html> <html lang="en"> <head> <meta charset="utf-8" /> <meta name="viewport" content="width=device-width,initial-scale=1" /> <title>Easy Green</title> <style> :root{--accent:#2f9c4a;--muted:#6b7280;--card:#fff;--bg:#f6fff6;--maxw:980px} *{box-sizing:border-box} body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:linear-gradient(#f6fff6,#eefef0);color:#111} .wrap{max-width:var(--maxw);margin:18px auto;padding:16px} header{display:flex;gap:12px;align-items:center} header h1{margin:0;color:var(--accent);font-size:1.3rem} .grid{display:grid;grid-template-columns:1fr 320px;gap:14px;margin-top:12px} @media (max-width:900px){.grid{grid-template-columns:1fr}} .card{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 8px 20px rgba(20,60,20,.06)} .products{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px} .product{border:1px solid #eee;padding:10px;border-radius:10px} .product h3{margin:6px 0 4px} .row{display:flex;gap:8px;align-items:center} label{font-size:.92rem} select,input[type="number"],input[type="file"]{padding:6px;border-radius:8px;border:1px solid #ddd} .btn{background:var(--accent);color:white;padding:8px 12px;border-radius:8px;border:0;cursor:pointer} .btn.ghost{background:#f3f3f3;color:#111} .small{font-size:.88rem;color:var(--muted)} .cart-item{display:flex;justify-content:space-between;gap:8px;padding:6px 0;border-bottom:1px dashed #eee} .modal-back{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;padding:16px;z-index:1000} .modal{width:100%;max-width:760px;background:white;padding:16px;border-radius:12px} .ticket{background:#fbfff9;border:1px dashed #e6f4ea;padding:10px;border-radius:8px;height:260px;overflow:auto} .ticket-entry{margin-bottom:8px} footer{margin-top:12px;color:var(--muted);font-size:.82rem} .hidden{display:none !important;} #adminScreen{position:fixed;inset:0;background:rgba(0,0,0,.95);color:#111;padding:16px;overflow:auto;display:none;z-index:3000} #adminScreen h2{margin-top:0;color:var(--accent)} .flavor-stock{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px} .flavor-stock span{font-size:.88rem} .option-disabled{color:#aaa !important} #shutdownNotice{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:4000;padding:20px} #shutdownNotice .modal{max-width:640px} .logoutBtn{background:#e53e3e;padding:8px 10px;border-radius:8px;color:#fff;border:0;cursor:pointer} </style> </head> <body> <!-- Login / Create Code Modal --> <div id="loginModal" class="modal-back"> <div class="modal"> <h3>Login</h3> <div style="margin-bottom:12px"> <label>Enter your login code or Create Account if new: <input type="text" id="loginCode"></label> </div> <div style="margin-bottom:12px">or <button class="btn" id="createCodeBtn">Create new code</button></div> <div style="display:flex;justify-content:flex-end;gap:8px"> <button class="btn" id="loginBtn">Login</button> </div> </div> </div> <!-- Warning modal --> <div id="warningModal" class="modal-back hidden"> <div class="modal"> <h3>Warnings & Rules</h3> <ul> <li>Easy Green is not liable for any stolen Product/Payments.</li> <li>Use products safely.</li> <li>Respect site anonymity.</li> </ul> <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end"> <label style="display:flex;align-items:center;gap:8px"> <input type="checkbox" id="ackCheck"> I agree </label> <button class="btn" id="ackBtn">Confirm</button> </div> </div> </div> <!-- First Time Help Modal --> <div id="helpModal" class="modal-back hidden"> <div class="modal"> <h3>First Time Help</h3> <p>Welcome to Easy Green! Here's how it works:</p> <ol> <li>Select products and flavors you want.</li> <li>Add items to your cart and choose pickup location.</li> <li>Click Purchase to generate a ticket for your order.</li> <li>Use the chat under your ticket to send messages or images to admin.</li> <li>Admin can respond and send images back. Keep communications secure and anonymous.</li> <li>Place the specified cash amount in an Envelope, and write a 4 digit code of your choosing on the Envelope</li> <li>Hide Envelope at your selected location in a very discreet and out of sight spot (Easy Green is not liable for stolen payments)</li> <li>Select the "Mark as paid" button, and send a photo of your envelope and where you hid it. (Make sure to not send a picture that shows your 4 digit code)</li> <li>Head home and wait for the deliverant to pick up your payment and hide your item. Once finished, the admin will message you your 4 digit code, an image of the product hidden, and any further information.</li> <li>Go pickup your product and have fun!</li> </ol> <button class="btn" id="closeHelp">Got it!</button> </div> </div> <!-- Shutdown Notice (site-wide shown when admin closes shop) --> <div id="shutdownNotice"> <div class="modal"> <h3>Easy Green — Temporary Update</h3> <p id="shutdownText">Easy Green is currently under an update, please stay patient as we try and make the Easy Green experience better for everyone.</p> <div style="margin-top:12px;display:flex;justify-content:flex-end"> <button class="btn" id="closeShutdownNotice">OK</button> </div> </div> </div> <!-- Main site --> <div class="wrap hidden" id="mainWrap"> <header> <svg width="44" height="44" viewBox="0 0 24 24" aria-hidden> <rect rx="6" width="24" height="24" fill="#2f9c4a"/> <text x="50%" y="60%" font-size="10" text-anchor="middle" fill="white" font-family="sans-serif">EG</text> </svg> <div style="flex:1"> <h1>Easy Green — Anonymous Cannabis </h1> </div> <div style="display:flex;gap:8px;align-items:center"> <button class="logoutBtn" id="logoutBtn">Logout</button> </div> </header> <div style="display:flex;gap:8px;align-items:center;margin-top:12px"> <div class="small">(Write this down) Your account code: <span id="acctCode"></span></div> <button class="btn" id="helpBtn" style="margin-left:auto">First time help</button> </div> <div class="grid" role="main"> <section class="card" aria-labelledby="productsLabel"> <h2 id="productsLabel">Products</h2> <div class="small" style="margin-bottom:8px">Select flavors and add to cart.</div> <div class="products" id="productsGrid"></div> </section> <aside class="card" aria-labelledby="cartLabel"> <h2 id="cartLabel">Cart & Pickup</h2> <div> <label class="small">Pickup Location</label> <select id="locationSelect" aria-label="Pickup location"> <option value="Hasbrook Park">Hasbrook Park</option> <option value="Virginia Terrace Park">Virginia Terrace Park</option> <option value="Frontier Park">Frontier Park</option> <option value="Pioneer Park">Pioneer Park</option> <option value="Grealish Park">Grealish Park</option> <option value="Happiness Park">Happiness Park</option> <option value="Greenbrier Park">Greenbrier Park</option> <option value="Kimball Hill Park">Kimball Hill Park</option> <option value="Centennial Park">Centennial Park</option> </select> </div> <div style="margin-top:12px"> <div id="cartList" aria-live="polite"></div> <div class="cart-total small" id="cartTotal"></div> </div> <div style="margin-top:12px;display:flex;gap:8px"> <button class="btn" id="purchaseBtn">Purchase</button> <button class="btn ghost" id="clearBtn">Clear</button> </div> <div style="margin-top:12px"> <div class="small">Tickets </div> <div id="ticketsArea" style="margin-top:8px"></div> </div> </aside> </div> <footer> Easy Green only accepts cash payments. Fake cash will result in a ban. </footer> </div> <!-- Admin Screen --> <div id="adminScreen"> <h2>Admin Console</h2> <div style="margin-bottom:12px;display:flex;gap:8px;align-items:center"> <button class="btn" id="refreshTickets">Refresh Tickets</button> <button class="btn ghost" id="closeAdmin">Close Admin</button> <button class="btn ghost" id="toggleShutdownBtn">Toggle Shutdown</button> <span class="small" id="shutdownStatus" style="margin-left:8px"></span> </div> <h3>Stock Control</h3> <div id="adminStockArea"></div> <h3>All Tickets</h3> <div id="allTicketsArea"></div> </div> <!-- Firebase SDK (compat for simpler transition) --> <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script> <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script> <script> /* ---------- Firebase init ---------- */ /* NOTE: these values were from your earlier snippet. If yours differ, replace them. */ const firebaseConfig = { apiKey: "AIzaSyA1JdHEgkIQKzX_FKZKNgLW6YEqAqMiRDo", authDomain: "easy-green-website.firebaseapp.com", databaseURL: "https://easy-green-website-default-rtdb.firebaseio.com", projectId: "easy-green-website", storageBucket: "easy-green-website.appspot.com", messagingSenderId: "988776675269", appId: "1:988776675269:web:f2245f84a726d01f3e3dac", measurementId: "G-PR35QWS2T6" }; firebase.initializeApp(firebaseConfig); const db = firebase.database(); /* ---------- end firebase ---------- */ </script> <script> document.addEventListener('DOMContentLoaded', () => { const PRODUCTS=[ {id:'c1',name:'Edibles',price:20,flavors:['Sour Patch','Skittlez','Swedish Fish','Watermelon','Starburst','Trolli','Peach Rings']}, {id:'c2',name:'2G Ghost Disposable Carts',price:40,flavors:['Alien Burger','Durban Gushers','Papaya','Ghost Train Haze','Purple Ice cream Cake','Black Mamba']}, ]; function uid6(){return Math.random().toString(36).slice(2,8).toUpperCase();} function money(n){return '$'+n.toFixed(2);} /* ---- Account & Login ---- */ let account = localStorage.getItem('eg_account') || ''; const acctEl = document.getElementById('acctCode'); function getAllCodes(){ return JSON.parse(localStorage.getItem('eg_codes')||'[]'); } function addCode(c){ let arr=getAllCodes(); if(!arr.includes(c)){ arr.push(c); localStorage.setItem('eg_codes',JSON.stringify(arr)); } } function cartKey(acc){ return 'eg_cart_'+acc; } function ticketKey(acc){ return 'eg_tickets_'+acc; } function showMainSite(){ document.getElementById('loginModal').classList.add('hidden'); document.getElementById('mainWrap').classList.remove('hidden'); // only show rules modal if not acked if(!localStorage.getItem('eg_ack')) document.getElementById('warningModal').classList.remove('hidden'); acctEl.textContent = account; initSiteScripts(); } /* ---- Login / Create ---- */ document.getElementById('loginBtn').onclick = () => { const code = document.getElementById('loginCode').value.trim(); if(!code){ alert('Enter code'); return; } if(code === 'joeygold54'){ showAdmin(); return; } const upper = code.toUpperCase(); if(!getAllCodes().includes(upper)){ alert('Invalid code'); return; } account = upper; localStorage.setItem('eg_account', account); showMainSite(); }; document.getElementById('createCodeBtn').onclick = () => { account = uid6(); addCode(account); localStorage.setItem('eg_account',account); alert('New code: '+account); showMainSite(); }; document.getElementById('ackBtn').onclick = () => { if(!document.getElementById('ackCheck').checked){ alert('Confirm rules'); return; } localStorage.setItem('eg_ack','1'); document.getElementById('warningModal').classList.add('hidden'); }; /* ---- Help + Logout ---- */ document.getElementById('helpBtn').onclick = ()=>{ document.getElementById('helpModal').classList.remove('hidden'); }; document.getElementById('closeHelp').onclick = ()=>{ document.getElementById('helpModal').classList.add('hidden'); }; document.getElementById('logoutBtn').onclick = ()=>{ localStorage.removeItem('eg_account'); account=''; document.getElementById('mainWrap').classList.add('hidden'); document.getElementById('loginModal').classList.remove('hidden'); }; /* ---- Shutdown notice close ---- */ document.getElementById('closeShutdownNotice').onclick = ()=>{ document.getElementById('shutdownNotice').style.display='none'; }; /* ---- Admin Screen & Shutdown Toggle ---- */ document.getElementById('closeAdmin').onclick = ()=>{ document.getElementById('adminScreen').style.display='none'; }; document.getElementById('refreshTickets').onclick = ()=>{ renderAdminTickets(); renderAdminStock(); }; document.getElementById('toggleShutdownBtn').onclick = async () => { const ref = db.ref('status/shutdown'); const snap = await ref.once('value'); const current = snap.val() === true; await ref.set(!current); // UI update will be handled by the realtime listener }; /* Realtime listeners for tickets & stock & shutdown status so changes show across devices */ let ticketsCache = []; // local copy maintained from DB db.ref('tickets').on('value', snap => { const obj = snap.val() || {}; // Convert to array sorted by id string (not required but consistent) ticketsCache = Object.values(obj); // Re-render admin area if open if(document.getElementById('adminScreen').style.display === 'block') renderAdminTickets(); // Re-render user's tickets if on main site and logged in if(account) renderTicketsForAccount(); }); db.ref('stock').on('value', snap => { // re-render product UI when stock changes if(document.getElementById('mainWrap').classList.contains('hidden') === false) initSiteScripts(); if(document.getElementById('adminScreen').style.display === 'block') renderAdminStock(); }); db.ref('status/shutdown').on('value', snap => { const isDown = snap.val() === true; document.getElementById('shutdownStatus').textContent = isDown ? '— SHOP CLOSED' : '— SHOP OPEN'; // Show notice to users if(isDown){ document.getElementById('shutdownNotice').style.display = 'flex'; } else { document.getElementById('shutdownNotice').style.display = 'none'; } }); /* ---- Site scripts ---- */ function initSiteScripts(){ const grid = document.getElementById('productsGrid'); grid.innerHTML = ''; PRODUCTS.forEach(p=>{ // fetch stock for this product db.ref('stock/'+p.id).once('value').then(snap=>{ const stock = snap.val() || {}; const el = document.createElement('div'); el.className = 'product'; el.innerHTML = <h3>${p.name}</h3> <div class="small">Price: ${money(p.price)}</div> <label>Flavor <select aria-label="flavor-${p.id}" class="flavorSelect"> ${p.flavors.map(f=>{ const disabled = stock[f] === false ? 'disabled class="option-disabled"' : ''; return <option ${disabled}>${f}</option>; }).join('')} </select> </label> <label>Qty<input type="number" min="1" value="1" class="qtyInput" style="width:70px"></label> <div style="margin-top:8px"><button class="btn addBtn">Add</button></div>; grid.appendChild(el); el.querySelector('.addBtn').addEventListener('click',()=>{ // prevent purchase when shutdown active db.ref('status/shutdown').once('value').then(s=> { if(s.val() === true){ alert('Easy Green is currently under an update. Purchases are temporarily disabled.'); return; } const flavor = el.querySelector('.flavorSelect').value; const qty = Number(el.querySelector('.qtyInput').value) || 1; if(stock[flavor] === false){ alert('Flavor out of stock'); return; } addToCart({productId:p.id,name:p.name,flavor,qty,price:p.price,image:null}); }); }); }); }); // load local cart/tickets state (we still read/write tickets to DB) let cart = JSON.parse(localStorage.getItem(cartKey(account))||'[]'); let tickets = []; // the local ticket list will be built from DB listener const cartList = document.getElementById('cartList'); const cartTotalEl = document.getElementById('cartTotal'); function saveCart(){ localStorage.setItem(cartKey(account), JSON.stringify(cart)); renderCart(); } function addToCart(item){ cart.push(item); saveCart(); alert('Added to cart'); } function renderCart(){ cartList.innerHTML = ''; if(cart.length === 0){ cartList.innerHTML = '<div class="small">Cart empty.</div>'; cartTotalEl.textContent = ''; return; } cart.forEach((it, idx)=>{ const div = document.createElement('div'); div.className = 'cart-item'; div.innerHTML = <div><div style="font-weight:600">${it.name} ×${it.qty}</div><div class="small">${it.flavor}</div>${it.image?'<img src="'+it.image+'" style="width:60px;margin-top:4px;border-radius:6px">':''}</div> <div style="text-align:right"><div>${money(it.price*it.qty)}</div><div style="margin-top:6px"><button class="btn ghost" data-i="${idx}">Remove</button></div></div>; cartList.appendChild(div); div.querySelector('button').addEventListener('click',(e)=>{ cart.splice(Number(e.target.dataset.i),1); saveCart(); }); }); const total = cart.reduce((s,i)=>s + i.price * i.qty, 0); cartTotalEl.textContent = Total: ${money(total)}; } document.getElementById('purchaseBtn').onclick = ()=>{ // prevent purchase when shutdown active db.ref('status/shutdown').once('value').then(s=>{ if(s.val() === true){ alert('Easy Green is currently under an update. Purchases are temporarily disabled.'); return; } if(cart.length === 0){ alert('Cart empty'); return; } const loc = document.getElementById('locationSelect').value; const tid = 'T-'+Math.random().toString(36).slice(2,8).toUpperCase(); const items = JSON.parse(JSON.stringify(cart)); const total = items.reduce((s,i)=>s + i.price*i.qty, 0); const ticket = { id:tid, account, location:loc, items, total, status:'open', messages:[ { from:'System', text:Ticket created. Total ${money(total)}. Hide payment at ${loc}. } ] }; // write to DB db.ref('tickets/'+tid).set(ticket).then(()=>{ // local feedback cart = []; saveCart(); alert('Ticket created: '+tid); }).catch(err=>{ console.error('DB write error', err); alert('Failed to create ticket (db).'); }); }); }; document.getElementById('clearBtn').addEventListener('click', ()=>{ if(confirm('Clear cart?')){ cart=[]; saveCart(); } }); renderCart(); // render tickets for this logged-in account using ticketsCache (kept in sync by DB listener) function renderTickets(){ // build from local ticketsCache const userTickets = ticketsCache.filter(t => t.account === account); const ticketsArea = document.getElementById('ticketsArea'); ticketsArea.innerHTML = ''; if(userTickets.length === 0){ ticketsArea.innerHTML = '<div class="small">No tickets yet.</div>'; return; } userTickets.forEach(t => { const el = document.createElement('div'); el.className='card'; el.style.marginBottom='8px'; el.innerHTML = <div style="display:flex;justify-content:space-between;align-items:center"> <div><strong>Ticket ${t.id}</strong> <span class="small">(${t.status})</span></div> <div class="small">${t.location}</div> </div> <div class="small" style="margin-top:6px">${t.items.map(it=>'' +it.name+' ×'+it.qty+' ('+it.flavor+')').join(' • ')}</div> <div style="margin-top:8px" id="ticket-${t.id}"> <div class="ticket" id="chat-${t.id}">${(t.messages||[]).map(m=>m.image?'<div><strong>'+m.from+':</strong><br><img src="'+m.image+'" style="max-width:100px;border-radius:6px"></div>':'<div><strong>'+m.from+':</strong> '+(m.text||'')+'</div>').join('')}</div> <div style="margin-top:8px;display:flex;gap:8px;align-items:center"> <input type="text" placeholder="Send message" id="msg-${t.id}" style="width:50%;padding:4px"> <input type="file" accept="image/*" id="file-${t.id}"> <button class="btn" onclick="sendUserMsg('${t.id}')">Send</button> <button class="btn ghost" onclick="markPaid('${t.id}')">Mark Paid</button> <button class="btn ghost" onclick="cancelOrder('${t.id}')">Cancel</button> </div> </div>; ticketsArea.appendChild(el); }); } // Expose function so DB listener can re-render for account window.renderTicketsForAccount = function(){ renderTickets(); }; // initial render if any renderTickets(); } /* expose user messaging/markPaid/cancel functions that operate on DB */ window.sendUserMsg = function(ticketId){ const msgEl = document.getElementById('msg-'+ticketId); const fileEl = document.getElementById('file-'+ticketId); if(!msgEl && !fileEl) return; const messages = []; const uploadAndPush = (msgs)=>{ // push messages array into DB messages list const ref = db.ref('tickets/'+ticketId+'/messages'); ref.once('value').then(snap=>{ const old = snap.val() || []; const merged = [...old, ...msgs]; ref.set(merged); }); }; if(fileEl && fileEl.files && fileEl.files[0]){ const reader = new FileReader(); reader.onload = (e) => { messages.push({ from:'User', image: e.target.result }); if(msgEl && msgEl.value.trim()){ messages.push({ from:'User', text: msgEl.value.trim() }); msgEl.value=''; } uploadAndPush(messages); }; reader.readAsDataURL(fileEl.files[0]); } else { if(msgEl && msgEl.value.trim()){ messages.push({ from:'User', text: msgEl.value.trim() }); msgEl.value=''; } if(messages.length) uploadAndPush(messages); } }; window.markPaid = function(ticketId){ // require photo to be attached? We'll allow status change + append system message placeholder for admin verification flow const fileInput = document.getElementById('file-'+ticketId); const messages = []; const updateStatus = ()=>{ db.ref('tickets/'+ticketId).once('value').then(snap=>{ const t = snap.val(); if(!t) return; t.status = 'paid'; db.ref('tickets/'+ticketId).set(t); }); }; if(fileInput && fileInput.files && fileInput.files[0]){ const reader = new FileReader(); reader.onload = (e)=>{ messages.push({ from:'User', image: e.target.result, text: 'Buyer marked as paid (image attached).' }); // append message then update status db.ref('tickets/'+ticketId+'/messages').once('value').then(snap=>{ const old = snap.val()||[]; db.ref('tickets/'+ticketId+'/messages').set([...old, ...messages]).then(()=> updateStatus()); }); }; reader.readAsDataURL(fileInput.files[0]); } else { // no image attached, just update status and add system note messages.push({ from:'System', text: 'Buyer marked payment complete (no image attached).' }); db.ref('tickets/'+ticketId+'/messages').once('value').then(snap=>{ const old = snap.val()||[]; db.ref('tickets/'+ticketId+'/messages').set([...old, ...messages]).then(()=> updateStatus()); }); } }; window.cancelOrder = function(ticketId){ if(!confirm('Cancel this order?')) return; db.ref('tickets/'+ticketId).remove(); }; /* ---- Admin functions (stock UI and tickets UI) ---- */ function renderAdminStock(){ const stockArea = document.getElementById('adminStockArea'); stockArea.innerHTML = ''; PRODUCTS.forEach(p=>{ const card = document.createElement('div'); card.className='card'; card.style.marginBottom='8px'; const container = document.createElement('div'); container.innerHTML = <strong>${p.name}</strong>; card.appendChild(container); // get current stock db.ref('stock/'+p.id).once('value').then(snap=>{ const stock = snap.val() || {}; p.flavors.forEach(f=>{ const row = document.createElement('div'); row.className='flavor-stock'; const label = document.createElement('label'); label.style.display='flex'; label.style.alignItems='center'; label.style.gap='8px'; const chk = document.createElement('input'); chk.type='checkbox'; chk.checked = stock[f] !== false; chk.dataset.prod = p.id; chk.dataset.flavor = f; // on change update DB chk.addEventListener('change', (e)=>{ const prod = e.target.dataset.prod; const flav = e.target.dataset.flavor; db.ref('stock/'+prod+'/'+flav).set(e.target.checked === true ? true : false).then(()=> { // nothing else — realtime listener will refresh site UIs }); }); const span = document.createElement('span'); span.textContent = ' ' + f; label.appendChild(chk); label.appendChild(span); row.appendChild(label); card.appendChild(row); }); stockArea.appendChild(card); }); }); } function renderAdminTickets(){ const allTicketsArea = document.getElementById('allTicketsArea'); allTicketsArea.innerHTML = ''; // use ticketsCache (kept in sync) const tickets = ticketsCache.slice().sort((a,b)=> a.id > b.id ? 1 : -1); if(tickets.length === 0){ allTicketsArea.innerHTML = '<div class="small">No tickets yet.</div>'; return; } tickets.forEach(t=>{ const div = document.createElement('div'); div.className='card'; div.style.marginBottom='8px'; div.innerHTML = <div style="font-weight:600">Ticket ${t.id} | Account: ${t.account} | Location: ${t.location} | Status: ${t.status}</div> <div class="small" style="margin-top:6px">${t.items.map(i=> i.name+' ×'+i.qty+' ('+i.flavor+')').join(' • ')}</div> <div id="adminChat-${t.id}" class="ticket">${(t.messages||[]).map(m => m.image?'<div><strong>'+m.from+':</strong><br><img src="'+m.image+'" style="max-width:100px;border-radius:6px"></div>':'<div><strong>'+m.from+':</strong> '+(m.text||'')+'</div>').join('')}</div> <div style="margin-top:6px;display:flex;gap:6px;align-items:center"> <input placeholder="Admin message" id="adminMsg-${t.id}" style="flex:1;padding:6px;border:1px solid #ddd;border-radius:6px"> <input type="file" accept="image/*" id="adminFile-${t.id}"> <button class="btn" onclick="sendAdmin('${t.account}','${t.id}')">Send</button> <button class="btn ghost" onclick="deleteOrder('${t.account}','${t.id}')">Delete</button> </div>; allTicketsArea.appendChild(div); }); } /* Admin send message */ window.sendAdmin = function(acct, ticketId){ const msgInput = document.getElementById('adminMsg-'+ticketId); const fileInput = document.getElementById('adminFile-'+ticketId); const messages = []; const pushMessages = (msgs)=>{ db.ref('tickets/'+ticketId+'/messages').once('value').then(snap=>{ const old = snap.val() || []; db.ref('tickets/'+ticketId+'/messages').set([...old, ...msgs]).then(()=>{ renderAdminTickets(); }); }); }; if(fileInput && fileInput.files && fileInput.files[0]){ const reader = new FileReader(); reader.onload = (e)=> { messages.push({ from:'Admin', image: e.target.result }); if(msgInput && msgInput.value.trim()) messages.push({ from:'Admin', text: msgInput.value.trim() }); pushMessages(messages); if(msgInput) msgInput.value = ''; if(fileInput) fileInput.value = ''; }; reader.readAsDataURL(fileInput.files[0]); } else { if(msgInput && msgInput.value.trim()) messages.push({ from:'Admin', text: msgInput.value.trim() }); if(messages.length) pushMessages(messages); if(msgInput) msgInput.value = ''; } }; window.deleteOrder = function(acct, ticketId){ if(!confirm('Delete this ticket?')) return; db.ref('tickets/'+ticketId).remove().then(()=>{ renderAdminTickets(); }); }; /* If not logged in at load, show login, otherwise show main site */ if(!account){ document.getElementById('loginModal').classList.remove('hidden'); } else { showMainSite(); } /* Make admin screen accessible by entering admin password on login (already handled above) */ /* Provide a small function so admin can open admin manually if logged in as admin code - we used login button check */ }); // DOMContentLoaded </script> </body> </html>



